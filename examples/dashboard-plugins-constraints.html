<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saharos Dashboard Builder - Constraints Plugin Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .demo-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 28px;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .header p {
      color: #718096;
      font-size: 16px;
    }

    .controls {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .controls h2 {
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 15px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-danger:hover {
      background: #e53e3e;
    }

    #dashboard {
      background: white;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      min-height: 600px;
      position: relative;
    }

    .constraints-info {
      background: #edf2f7;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .constraints-info h3 {
      font-size: 16px;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .constraints-info ul {
      list-style-position: inside;
      color: #4a5568;
    }

    .constraints-info li {
      margin-bottom: 5px;
    }

    .status {
      background: #f7fafc;
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
      font-size: 14px;
      color: #4a5568;
    }

    .status.error {
      background: #fed7d7;
      color: #742a2a;
    }

    .status.success {
      background: #c6f6d5;
      color: #22543d;
    }

    .widget-content {
      padding: 20px;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .widget-content h3 {
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .widget-content p {
      color: #718096;
      font-size: 14px;
    }

    .restricted-area {
      position: absolute;
      background: repeating-linear-gradient(
        45deg,
        rgba(245, 101, 101, 0.1),
        rgba(245, 101, 101, 0.1) 10px,
        rgba(245, 101, 101, 0.2) 10px,
        rgba(245, 101, 101, 0.2) 20px
      );
      border: 2px dashed #f56565;
      pointer-events: none;
      z-index: 1;
    }

    .restricted-label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #f56565;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="header">
      <h1>Constraints Plugin Demo</h1>
      <p>
        This demo shows the Constraints Plugin that enforces validation rules on widgets.
        Try adding widgets or resizing them to see the constraints in action!
      </p>
    </div>

    <div class="controls">
      <h2>Controls</h2>

      <div class="constraints-info">
        <h3>Active Constraints:</h3>
        <ul>
          <li>Maximum 6 widgets allowed</li>
          <li>Minimum widget size: 2x2</li>
          <li>Maximum widget size: 6x4</li>
          <li>Maximum 8 rows</li>
          <li>Restricted area at (6, 4) with size 4x2 (red striped zone)</li>
        </ul>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="addValidWidget()">Add Valid Widget</button>
        <button class="btn-danger" onclick="addInvalidWidget()">Try Add 7th Widget</button>
      </div>

      <div class="status" id="status">
        Status: Ready. Try adding or resizing widgets to test constraints.
      </div>
    </div>

    <div id="dashboard"></div>
  </div>

  <script type="module">
    import {
      IAZDashboard,
      createConstraintsPlugin
    } from '../dist/iazd-dashboard.esm.js';

    // Create dashboard with constraints plugin
    const dashboard = new IAZDashboard('#dashboard', {
      columns: 12,
      rowHeight: 60,
      margin: 10,
      draggable: true,
      resizable: true,
      animate: true,
      autoPosition: true,
      debug: true,
    }).use(createConstraintsPlugin({
      maxWidgets: 6,
      minWidgetSize: { w: 2, h: 2 },
      maxWidgetSize: { w: 6, h: 4 },
      maxRows: 8,
      restrictedAreas: [
        { x: 6, y: 4, w: 4, h: 2 }
      ],
      blockInvalid: true,
    }));

    // Add restricted area visual indicator
    function addRestrictedAreaIndicator() {
      const gridEl = document.querySelector('.iazd-grid');
      if (!gridEl) return;

      const margin = 10;
      const columns = 12;
      const rowHeight = 60;
      const containerWidth = gridEl.offsetWidth;
      const cellWidth = (containerWidth - margin * (columns + 1)) / columns;

      const restrictedArea = {
        x: 6,
        y: 4,
        w: 4,
        h: 2
      };

      const left = margin + restrictedArea.x * (cellWidth + margin);
      const top = margin + restrictedArea.y * (rowHeight + margin);
      const width = restrictedArea.w * cellWidth + (restrictedArea.w - 1) * margin;
      const height = restrictedArea.h * rowHeight + (restrictedArea.h - 1) * margin;

      const div = document.createElement('div');
      div.className = 'restricted-area';
      div.style.left = `${left}px`;
      div.style.top = `${top}px`;
      div.style.width = `${width}px`;
      div.style.height = `${height}px`;

      const label = document.createElement('div');
      label.className = 'restricted-label';
      label.textContent = 'RESTRICTED AREA';
      div.appendChild(label);

      gridEl.appendChild(div);
    }

    // Add initial widgets
    dashboard.addWidget({
      id: 'widget-1',
      x: 0,
      y: 0,
      w: 4,
      h: 3,
      content: createWidgetContent('Widget 1', 'Size: 4x3'),
    });

    dashboard.addWidget({
      id: 'widget-2',
      x: 4,
      y: 0,
      w: 3,
      h: 2,
      content: createWidgetContent('Widget 2', 'Size: 3x2'),
    });

    dashboard.addWidget({
      id: 'widget-3',
      x: 0,
      y: 3,
      w: 3,
      h: 3,
      content: createWidgetContent('Widget 3', 'Size: 3x3'),
    });

    // Add restricted area indicator after dashboard is ready
    dashboard.on('dashboard:ready', () => {
      setTimeout(addRestrictedAreaIndicator, 100);
    });

    // Helper to create widget content
    function createWidgetContent(title, description) {
      const div = document.createElement('div');
      div.className = 'widget-content';
      div.innerHTML = `
        <h3>${title}</h3>
        <p>${description}</p>
      `;
      return div;
    }

    // Global functions for buttons
    let widgetCounter = 4;

    window.addValidWidget = function() {
      const state = dashboard.getState();

      if (state.widgets.length >= 6) {
        updateStatus('Cannot add widget: Maximum 6 widgets allowed!', 'error');
        return;
      }

      try {
        const widget = dashboard.addWidget({
          id: `widget-${widgetCounter++}`,
          w: 3,
          h: 2,
          content: createWidgetContent(
            `Widget ${widgetCounter - 1}`,
            `Size: 3x2`
          ),
        });
        updateStatus(`Widget ${widget.id} added successfully!`, 'success');
      } catch (error) {
        updateStatus(`Error: ${error.message}`, 'error');
      }
    };

    window.addInvalidWidget = function() {
      const state = dashboard.getState();
      updateStatus(`Attempting to add widget (current count: ${state.widgets.length}/6)...`, 'info');

      setTimeout(() => {
        try {
          dashboard.addWidget({
            id: `widget-${widgetCounter++}`,
            w: 3,
            h: 2,
            content: createWidgetContent(
              `Widget ${widgetCounter - 1}`,
              `Size: 3x2`
            ),
          });
        } catch (error) {
          // Widget might be added but then removed by constraints
        }
      }, 500);
    };

    function updateStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.className = `status ${type}`;
      status.innerHTML = `<strong>Status:</strong> ${message}`;

      if (type !== 'info') {
        setTimeout(() => {
          status.className = 'status';
          status.innerHTML = '<strong>Status:</strong> Ready. Try adding or resizing widgets to test constraints.';
        }, 4000);
      }
    }

    // Listen to constraint violation events
    dashboard.on('constraint:violation', (data) => {
      console.log('Constraint violation:', data);
      updateStatus(`Constraint violation: ${data.reason}`, 'error');
    });

    dashboard.on('plugin:constraints:ready', (config) => {
      console.log('Constraints plugin ready:', config);
    });
  </script>
</body>
</html>
