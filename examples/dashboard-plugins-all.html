<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saharos Dashboard Builder - All Plugins Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .demo-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 28px;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .header p {
      color: #718096;
      font-size: 16px;
      line-height: 1.6;
    }

    .plugins-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .plugin-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .plugin-card h3 {
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .plugin-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }

    .plugin-badge.save {
      background: #48bb78;
    }

    .plugin-badge.constraints {
      background: #ed8936;
    }

    .plugin-badge.snaplines {
      background: #4299e1;
    }

    .plugin-card ul {
      list-style-position: inside;
      color: #4a5568;
      font-size: 14px;
      line-height: 1.8;
    }

    .controls {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .controls h2 {
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 15px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-danger:hover {
      background: #e53e3e;
    }

    #dashboard {
      background: white;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      min-height: 600px;
    }

    .status {
      background: #f7fafc;
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
      font-size: 14px;
      color: #4a5568;
    }

    .status.error {
      background: #fed7d7;
      color: #742a2a;
    }

    .status.success {
      background: #c6f6d5;
      color: #22543d;
    }

    .widget-content {
      padding: 20px;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .widget-content h3 {
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .widget-content p {
      color: #718096;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="header">
      <h1>All Plugins Demo - v0.7.0 Plugin System</h1>
      <p>
        This demo showcases all three built-in plugins working together: Save, Constraints, and Snaplines.
        Experience the full power of the plugin system with auto-save, validation rules, and visual alignment guides!
      </p>
    </div>

    <div class="plugins-grid">
      <div class="plugin-card">
        <h3>
          <span class="plugin-badge save">SAVE</span>
          Auto-Save Plugin
        </h3>
        <ul>
          <li>Auto-saves to localStorage</li>
          <li>Persists across page refreshes</li>
          <li>500ms debounced saving</li>
        </ul>
      </div>

      <div class="plugin-card">
        <h3>
          <span class="plugin-badge constraints">CONSTRAINTS</span>
          Constraints Plugin
        </h3>
        <ul>
          <li>Max 8 widgets allowed</li>
          <li>Min size: 2x2, Max: 6x4</li>
          <li>Maximum 10 rows</li>
        </ul>
      </div>

      <div class="plugin-card">
        <h3>
          <span class="plugin-badge snaplines">SNAPLINES</span>
          Snaplines Plugin
        </h3>
        <ul>
          <li>Visual alignment guides</li>
          <li>10px snap threshold</li>
          <li>Works during drag & resize</li>
        </ul>
      </div>
    </div>

    <div class="controls">
      <h2>Controls</h2>
      <div class="button-group">
        <button class="btn-primary" onclick="addWidget()">Add Widget</button>
        <button class="btn-danger" onclick="clearAll()">Clear All & Reset</button>
      </div>
      <div class="status" id="status">
        All plugins loaded successfully! Widget count: <span id="count">0</span>/8
      </div>
    </div>

    <div id="dashboard"></div>
  </div>

  <script type="module">
    import {
      IAZDashboard,
      savePlugin,
      createConstraintsPlugin,
      snaplinesPlugin
    } from '../dist/iazd-dashboard.esm.js';

    // Create dashboard with all plugins
    const dashboard = new IAZDashboard('#dashboard', {
      columns: 12,
      rowHeight: 60,
      margin: 10,
      draggable: true,
      resizable: true,
      animate: true,
      autoPosition: true,
      floatMode: true,
      storageKey: 'iazd-all-plugins-demo',
      debug: true,
    })
      .use(savePlugin)
      .use(createConstraintsPlugin({
        maxWidgets: 8,
        minWidgetSize: { w: 2, h: 2 },
        maxWidgetSize: { w: 6, h: 4 },
        maxRows: 10,
        blockInvalid: true,
      }))
      .use(snaplinesPlugin);

    // Initialize with some widgets if none exist
    const state = dashboard.getState();
    if (state.widgets.length === 0) {
      const initialWidgets = [
        { id: 1, x: 0, y: 0, w: 4, h: 3, title: 'Analytics', desc: 'Auto-saved' },
        { id: 2, x: 4, y: 0, w: 4, h: 3, title: 'Reports', desc: 'Constrained' },
        { id: 3, x: 8, y: 0, w: 4, h: 3, title: 'Insights', desc: 'Snap-aligned' },
      ];

      initialWidgets.forEach(w => {
        dashboard.addWidget({
          id: `widget-${w.id}`,
          x: w.x,
          y: w.y,
          w: w.w,
          h: w.h,
          content: createWidgetContent(w.title, w.desc),
        });
      });
    }

    updateWidgetCount();

    // Helper to create widget content
    function createWidgetContent(title, description) {
      const div = document.createElement('div');
      div.className = 'widget-content';
      div.innerHTML = `
        <h3>${title}</h3>
        <p>${description}</p>
      `;
      return div;
    }

    // Global functions
    let widgetCounter = 4;

    window.addWidget = function() {
      const currentState = dashboard.getState();

      if (currentState.widgets.length >= 8) {
        updateStatus('Cannot add widget: Maximum 8 widgets allowed (Constraints Plugin)', 'error');
        return;
      }

      try {
        const titles = ['Dashboard', 'Charts', 'Metrics', 'Stats', 'Data', 'Graphs', 'Trends', 'Insights'];
        const title = titles[Math.floor(Math.random() * titles.length)];

        dashboard.addWidget({
          id: `widget-${widgetCounter++}`,
          w: Math.floor(Math.random() * 3) + 2,
          h: Math.floor(Math.random() * 2) + 2,
          content: createWidgetContent(
            `${title} ${widgetCounter - 1}`,
            'All plugins active'
          ),
        });

        updateWidgetCount();
        updateStatus('Widget added successfully!', 'success');
      } catch (error) {
        updateStatus(`Error: ${error.message}`, 'error');
      }
    };

    window.clearAll = function() {
      if (confirm('Clear all widgets and reset saved state?')) {
        dashboard.clearSavedState();
        const widgets = dashboard.getState().widgets;
        widgets.forEach(w => dashboard.removeWidget(w.id));
        updateWidgetCount();
        updateStatus('All cleared! Add some widgets to get started.', 'success');
      }
    };

    function updateWidgetCount() {
      const count = dashboard.getState().widgets.length;
      document.getElementById('count').textContent = count;
    }

    function updateStatus(message, type = 'info') {
      const status = document.getElementById('status');
      const count = dashboard.getState().widgets.length;

      if (type === 'info') {
        status.className = 'status';
        status.innerHTML = `${message} Widget count: <span id="count">${count}</span>/8`;
      } else {
        status.className = `status ${type}`;
        status.innerHTML = `<strong>${type === 'error' ? 'Error' : 'Success'}:</strong> ${message}`;

        setTimeout(() => {
          status.className = 'status';
          const newCount = dashboard.getState().widgets.length;
          status.innerHTML = `All plugins loaded successfully! Widget count: <span id="count">${newCount}</span>/8`;
        }, 3000);
      }
    }

    // Listen to events
    dashboard.on('widget:add', updateWidgetCount);
    dashboard.on('widget:remove', updateWidgetCount);

    dashboard.on('save:success', (data) => {
      console.log('✓ Save Plugin: State saved to localStorage');
    });

    dashboard.on('constraint:violation', (data) => {
      console.log('✗ Constraints Plugin: Violation detected -', data.reason);
    });

    dashboard.on('snapline:show', (data) => {
      console.log('→ Snaplines Plugin: Alignment guide shown');
    });

    // Plugin ready events
    let pluginsReady = 0;
    const totalPlugins = 3;

    dashboard.on('plugin:save:ready', () => {
      console.log('Plugin ready: Save');
      pluginsReady++;
      checkAllPluginsReady();
    });

    dashboard.on('plugin:constraints:ready', () => {
      console.log('Plugin ready: Constraints');
      pluginsReady++;
      checkAllPluginsReady();
    });

    dashboard.on('plugin:snaplines:ready', () => {
      console.log('Plugin ready: Snaplines');
      pluginsReady++;
      checkAllPluginsReady();
    });

    function checkAllPluginsReady() {
      if (pluginsReady === totalPlugins) {
        console.log('✓ All 3 plugins initialized successfully!');
        updateStatus('All plugins loaded successfully!', 'success');
      }
    }
  </script>
</body>
</html>
